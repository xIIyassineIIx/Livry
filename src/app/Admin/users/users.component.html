<div class="main-container">
  <h2>Gestion des utilisateurs</h2>

  <div class="content-wrapper">
    <div class="users-table card">
      <h3>Liste des utilisateurs</h3>
      <table>
        <thead>
          <tr>
            <th>Nom complet</th>
            <th>Email</th>
            <th>Rôle</th>
            <th>Région</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td>{{ user.firstName }} {{ user.lastName }}</td>
            <td>{{ user.email }}</td>
            <td>
              <ng-container *ngIf="editingUserId !== user.id; else editRole">
                <span class="role-badge" [class]="'role-' + user.role?.toLowerCase()">
                  {{ user.role }}
                </span>
              </ng-container>
              <ng-template #editRole>
                <select [(ngModel)]="selectedRole" class="role-select">
                  <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
                </select>
              </ng-template>
            </td>
            <td>{{ user.region || '—' }}</td>
            <td>
              <ng-container *ngIf="editingUserId !== user.id">
                <button class="btn-edit" (click)="startEdit(user)">Modifier</button>
                <button class="btn-delete" (click)="deleteUser(user)">Supprimer</button>
              </ng-container>
              <ng-container *ngIf="editingUserId === user.id">
                <button class="btn-save" (click)="saveRole(user)">Enregistrer</button>
                <button class="btn-cancel" (click)="cancelEdit()">Annuler</button>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="add-user-card card">
      <h3>Ajouter un utilisateur</h3>
      <form (ngSubmit)="addUser()" #userForm="ngForm">
        <input type="text" placeholder="Prénom" [(ngModel)]="user.firstName" name="firstName" required>
        <input type="text" placeholder="Nom" [(ngModel)]="user.lastName" name="lastName" required>
        <input type="email" placeholder="Email" [(ngModel)]="user.email" name="email" required>

        <select [(ngModel)]="user.role" name="role" required>
          <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
        </select>

        <select [(ngModel)]="user.region" name="region">
          <option [ngValue]="null">-- Région --</option>
          <option *ngFor="let region of regions" [value]="region">{{ region }}</option>
        </select>

        <button type="submit" class="btn-add">Créer le compte</button>
      </form>

      <p class="success" *ngIf="successMessage">{{ successMessage }}</p>
      <p class="error" *ngIf="errorMessage">{{ errorMessage }}</p>
    </div>
  </div>
</div>
