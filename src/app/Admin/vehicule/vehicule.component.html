<div class="main-container">
  <h2>Gestion des Véhicules</h2>

  <div class="form-card card">
    <h3>Ajouter un véhicule</h3>
    <form [formGroup]="vehicleForm" (ngSubmit)="submitForm()">
      <div class="form-row">
        <input formControlName="brand" placeholder="Marque" required>
        <input formControlName="model" placeholder="Modèle" required>
        <input formControlName="plateNumber" placeholder="Immatriculation" required>
      </div>
      <div class="form-actions">
        <button type="submit" class="btn-primary">Ajouter</button>
        <button type="button" class="btn-secondary" (click)="resetForm()">Annuler</button>
      </div>
    </form>
  </div>

  <div class="vehicle-table card">
    <h3>Liste des véhicules</h3>
    <table>
      <thead>
        <tr>
          <th>Véhicule</th>
          <th>Immatriculation</th>
          <th>État</th>
          <th>Chauffeur</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let v of vehicles">
          <td>{{ v.brand }} {{ v.model }}</td>
          <td>{{ v.plateNumber }}</td>
          <td>
            <span class="status-badge" [class]="'status-' + v.status.toLowerCase()">
              {{ v.status }}
            </span>
          </td>
          <td>{{ v.driver ? v.driver.firstName + ' ' + v.driver.lastName : 'Non assigné' }}</td>
          <td>
            <button class="btn-edit" (click)="openEditPopup(v)">Modifier</button>
            <button class="btn-assign" (click)="openAssignPopup(v)">Assigner</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Edit Popup -->
  <div class="popup" *ngIf="showPopup">
    <div class="popup-content">
      <h3>Modifier le véhicule</h3>
      <form [formGroup]="editForm" (ngSubmit)="updateVehicle()">
        <input formControlName="brand" placeholder="Marque" required>
        <input formControlName="model" placeholder="Modèle" required>
        <input formControlName="plateNumber" placeholder="Immatriculation" required>
        <select formControlName="status" required>
          <option *ngFor="let status of vehicleStatuses" [value]="status">
            {{ status }}
          </option>
        </select>
        <div class="popup-actions">
          <button type="submit" class="btn-primary">Sauvegarder</button>
          <button type="button" class="btn-secondary" (click)="closePopup()">Annuler</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Assign Popup -->
  <div class="popup" *ngIf="showAssignPopup">
    <div class="popup-content">
      <h3>Assigner un chauffeur</h3>
      <form [formGroup]="assignForm" (ngSubmit)="assignDriver()">
        <label>Véhicule: {{ assigningVehicle?.brand }} {{ assigningVehicle?.model }}</label>
        <select formControlName="driverId" required>
          <option value="" disabled selected>-- Sélectionner un chauffeur --</option>
          <option *ngFor="let d of drivers" [value]="d.id">
            {{ d.firstName }} {{ d.lastName }} ({{ d.email }})
          </option>
        </select>
        <div class="popup-actions">
          <button type="submit" class="btn-primary" [disabled]="assignForm.invalid">Assigner</button>
          <button type="button" class="btn-secondary" (click)="closeAssignPopup()">Annuler</button>
        </div>
      </form>
    </div>
  </div>
</div>
