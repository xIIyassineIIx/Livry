<div class="main-container">
  <div class="package-tracking">
    <div class="map-section">
      <div id="map" class="map-container"></div>
      <div class="map-info" *ngIf="selectedDelivery">
        <h4>{{ selectedDelivery.description }}</h4>
        <p><strong>Statut:</strong> {{ getStatusLabel(selectedDelivery.status) }}</p>
        <p><strong>Type:</strong> {{ selectedDelivery.type }}</p>
        <p *ngIf="selectedDelivery.driver">
          <strong>Chauffeur:</strong> {{ selectedDelivery.driver.firstName }} {{ selectedDelivery.driver.lastName }}
        </p>
        <p *ngIf="selectedDelivery.station">
          <strong>Station:</strong> {{ selectedDelivery.station.name }}
        </p>
      </div>
    </div>

    <div class="activity-section">
      <div class="activity-header">
        <h3>Mes Livraisons</h3>
        <div class="actions">
          <input 
            type="text" 
            placeholder="Rechercher..." 
            class="search-bar"
            [(ngModel)]="searchTerm"
            (input)="applyFilters()" />
          <select [(ngModel)]="statusFilter" (change)="applyFilters()">
            <option value="ALL">Tous les statuts</option>
            <option [value]="DeliveryStatus.PENDING">En attente</option>
            <option [value]="DeliveryStatus.ACCEPTED">Accept√©e</option>
            <option [value]="DeliveryStatus.IN_TRANSIT">En transit</option>
            <option [value]="DeliveryStatus.DRIVER_TRANSFER">Transf√©r√©e</option>
            <option [value]="DeliveryStatus.DELIVERED">Livr√©e</option>
            <option [value]="DeliveryStatus.CANCELED">Annul√©e</option>
          </select>
          <button class="add-btn" routerLink="/client/ajoute-colis">+ Nouvelle livraison</button>
        </div>
      </div>

      <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>
      <div class="loading" *ngIf="loading">Chargement...</div>

      <table class="activity-table" *ngIf="!loading && filteredDeliveries.length > 0">
        <thead>
          <tr>
            <th>Route</th>
            <th>Description</th>
            <th>Date de cr√©ation</th>
            <th>Type</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr 
            *ngFor="let delivery of filteredDeliveries"
            [class.selected]="selectedDelivery?.id === delivery.id"
            (click)="selectDelivery(delivery)">
            <td>
              <div class="route">
                <span class="city">{{ delivery.departureAddress.city }}</span>
                <div class="line"></div>
                <span class="city">{{ delivery.arrivalAddress.city }}</span>
              </div>
              <div class="route-details">
                <small>{{ delivery.departureAddress.region }} ‚Üí {{ delivery.arrivalAddress.region }}</small>
              </div>
            </td>
            <td>{{ delivery.description }}</td>
            <td>{{ formatDate(delivery.createdAt) }}</td>
            <td>
              <span class="type-badge type-{{ delivery.type.toLowerCase() }}">
                {{ delivery.type }}
              </span>
            </td>
            <td>
              <span class="status status-{{ getStatusClass(delivery.status) }}">
                {{ getStatusLabel(delivery.status) }}
              </span>
            </td>
            <td>
              <button class="btn-track" (click)="selectDelivery(delivery); $event.stopPropagation()">
                üìç Suivre
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="no-data" *ngIf="!loading && filteredDeliveries.length === 0">
        <p *ngIf="deliveries.length === 0">
          Aucune livraison pour le moment. 
          <a routerLink="/client/ajoute-colis">Cr√©er une nouvelle livraison</a>
        </p>
        <p *ngIf="deliveries.length > 0 && filteredDeliveries.length === 0">
          Aucune livraison ne correspond √† vos crit√®res de recherche.
        </p>
      </div>
    </div>
  </div>
</div>
